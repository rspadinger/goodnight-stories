<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Histoires du Soir de Nayana</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Add clickable image style */
        .card-image {
            cursor: pointer;
        }
        
        .card-image img:hover {
            transform: scale(1.05);
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="language-selector">
        <button class="language-button active" data-lang="fr">
            <span>FR</span>
        </button>
        <button class="language-button" data-lang="de">
            <span>DE</span>
        </button>
    </div>

    <header class="site-header">
        <img src="images/header.jpg" alt="Les Histoires du Soir de Nayana" class="header-image">
        <button class="bg-music-button play-button" id="bgMusicButton">
            <i class="fas fa-play"></i>
        </button>
        <audio id="bgMusic" preload="metadata" class="audio-player">
            <source src="mp3/song.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
    </header>
    
    <main class="content">
        <!-- First row of cards -->
        <div class="card-container">
            <div class="card" data-story-id="1">
                <div class="card-title" data-fr="La Licorne Magique" data-de="Das magische Einhorn">La Licorne Magique</div>
                <div class="card-image">
                    <img src="images/img1.png" alt="La Licorne Magique">
                </div>
                <div class="card-controls">
                    <div class="audio-progress">
                        <input type="range" min="0" max="100" value="0" class="progress-slider">
                        <div class="time-display">
                            <span class="current-time">0:00</span>
                            <span class="duration">0:00</span>
                        </div>
                    </div>
                    <button class="play-button">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                <a href="story.html?id=1" class="read-story-link">
                    <i class="fas fa-book-open"></i>
                    <span class="read-text" data-fr="Lire l'histoire" data-de="Geschichte lesen">Lire l'histoire</span>
                </a>
                <audio preload="metadata" class="audio-player" data-story-id="1">
                    <source src="mp3/story1-FR.mp3" type="audio/mpeg" class="audio-source">
                    Your browser does not support the audio element.
                </audio>
            </div>
            
            <div class="card" data-story-id="2">
                <div class="card-title" data-fr="Le Royaume des Fées" data-de="Das Feenreich">Le Royaume des Fées</div>
                <div class="card-image">
                    <img src="/images/img1.png" alt="Le Royaume des Fées">
                </div>
                <div class="card-controls">
                    <div class="audio-progress">
                        <input type="range" min="0" max="100" value="0" class="progress-slider">
                        <div class="time-display">
                            <span class="current-time">0:00</span>
                            <span class="duration">0:00</span>
                        </div>
                    </div>
                    <button class="play-button">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                <a href="story.html?id=2" class="read-story-link">
                    <i class="fas fa-book-open"></i>
                    <span class="read-text" data-fr="Lire l'histoire" data-de="Geschichte lesen">Lire l'histoire</span>
                </a>
                <audio preload="metadata" class="audio-player" data-story-id="2">
                    <source src="mp3/story2-FR.mp3" type="audio/mpeg" class="audio-source">
                    Your browser does not support the audio element.
                </audio>
            </div>
            
            <div class="card" data-story-id="3">
                <div class="card-title" data-fr="L'Arbre Enchanté" data-de="Der verzauberte Baum">L'Arbre Enchanté</div>
                <div class="card-image">
                    <img src="/images/img1.png" alt="L'Arbre Enchanté">
                </div>
                <div class="card-controls">
                    <div class="audio-progress">
                        <input type="range" min="0" max="100" value="0" class="progress-slider">
                        <div class="time-display">
                            <span class="current-time">0:00</span>
                            <span class="duration">0:00</span>
                        </div>
                    </div>
                    <button class="play-button">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                <a href="story.html?id=3" class="read-story-link">
                    <i class="fas fa-book-open"></i>
                    <span class="read-text" data-fr="Lire l'histoire" data-de="Geschichte lesen">Lire l'histoire</span>
                </a>
                <audio preload="metadata" class="audio-player" data-story-id="3">
                    <source src="mp3/story3-FR.mp3" type="audio/mpeg" class="audio-source">
                    Your browser does not support the audio element.
                </audio>
            </div>
            
            <div class="card" data-story-id="4">
                <div class="card-title" data-fr="Le Voyage des Étoiles" data-de="Die Reise der Sterne">Le Voyage des Étoiles</div>
                <div class="card-image">
                    <img src="/images/img1.png" alt="Le Voyage des Étoiles">
                </div>
                <div class="card-controls">
                    <div class="audio-progress">
                        <input type="range" min="0" max="100" value="0" class="progress-slider">
                        <div class="time-display">
                            <span class="current-time">0:00</span>
                            <span class="duration">0:00</span>
                        </div>
                    </div>
                    <button class="play-button">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                <a href="story.html?id=4" class="read-story-link">
                    <i class="fas fa-book-open"></i>
                    <span class="read-text" data-fr="Lire l'histoire" data-de="Geschichte lesen">Lire l'histoire</span>
                </a>
                <audio preload="metadata" class="audio-player" data-story-id="4">
                    <source src="mp3/story4-FR.mp3" type="audio/mpeg" class="audio-source">
                    Your browser does not support the audio element.
                </audio>
            </div>

            <div class="card" data-story-id="5">
                <div class="card-title" data-fr="Le Dragon Amical" data-de="Der freundliche Drache">Le Dragon Amical</div>
                <div class="card-image">
                    <img src="/images/img1.png" alt="Le Dragon Amical">
                </div>
                <div class="card-controls">
                    <div class="audio-progress">
                        <input type="range" min="0" max="100" value="0" class="progress-slider">
                        <div class="time-display">
                            <span class="current-time">0:00</span>
                            <span class="duration">0:00</span>
                        </div>
                    </div>
                    <button class="play-button">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                <a href="story.html?id=5" class="read-story-link">
                    <i class="fas fa-book-open"></i>
                    <span class="read-text" data-fr="Lire l'histoire" data-de="Geschichte lesen">Lire l'histoire</span>
                </a>
                <audio preload="metadata" class="audio-player" data-story-id="5">
                    <source src="mp3/story5-FR.mp3" type="audio/mpeg" class="audio-source">
                    Your browser does not support the audio element.
                </audio>
            </div>
            
            <div class="card" data-story-id="6">
                <div class="card-title" data-fr="La Forêt Mystérieuse" data-de="Der geheimnisvolle Wald">La Forêt Mystérieuse</div>
                <div class="card-image">
                    <img src="/images/img1.png" alt="La Forêt Mystérieuse">
                </div>
                <div class="card-controls">
                    <div class="audio-progress">
                        <input type="range" min="0" max="100" value="0" class="progress-slider">
                        <div class="time-display">
                            <span class="current-time">0:00</span>
                            <span class="duration">0:00</span>
                        </div>
                    </div>
                    <button class="play-button">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                <a href="story.html?id=6" class="read-story-link">
                    <i class="fas fa-book-open"></i>
                    <span class="read-text" data-fr="Lire l'histoire" data-de="Geschichte lesen">Lire l'histoire</span>
                </a>
                <audio preload="metadata" class="audio-player" data-story-id="6">
                    <source src="mp3/story6-FR.mp3" type="audio/mpeg" class="audio-source">
                    Your browser does not support the audio element.
                </audio>
            </div>
            
            <div class="card" data-story-id="7">
                <div class="card-title" data-fr="Le Château Nuages" data-de="Das Schloss in den Wolken">Le Château dans les Nuages</div>
                <div class="card-image">
                    <img src="/images/img1.png" alt="Le Château Nuages">
                </div>
                <div class="card-controls">
                    <div class="audio-progress">
                        <input type="range" min="0" max="100" value="0" class="progress-slider">
                        <div class="time-display">
                            <span class="current-time">0:00</span>
                            <span class="duration">0:00</span>
                        </div>
                    </div>
                    <button class="play-button">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                <a href="story.html?id=7" class="read-story-link">
                    <i class="fas fa-book-open"></i>
                    <span class="read-text" data-fr="Lire l'histoire" data-de="Geschichte lesen">Lire l'histoire</span>
                </a>
                <audio preload="metadata" class="audio-player" data-story-id="7">
                    <source src="mp3/story7-FR.mp3" type="audio/mpeg" class="audio-source">
                    Your browser does not support the audio element.
                </audio>
            </div>
            
            <div class="card" data-story-id="8">
                <div class="card-title" data-fr="La Rivière Enchantée" data-de="Der verzauberte Fluss">La Rivière Enchantée</div>
                <div class="card-image">
                    <img src="/images/img1.png" alt="La Rivière Enchantée">
                </div>
                <div class="card-controls">
                    <div class="audio-progress">
                        <input type="range" min="0" max="100" value="0" class="progress-slider">
                        <div class="time-display">
                            <span class="current-time">0:00</span>
                            <span class="duration">0:00</span>
                        </div>
                    </div>
                    <button class="play-button">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                <a href="story.html?id=8" class="read-story-link">
                    <i class="fas fa-book-open"></i>
                    <span class="read-text" data-fr="Lire l'histoire" data-de="Geschichte lesen">Lire l'histoire</span>
                </a>
                <audio preload="metadata" class="audio-player" data-story-id="8">
                    <source src="mp3/story8-FR.mp3" type="audio/mpeg" class="audio-source">
                    Your browser does not support the audio element.
                </audio>
            </div>
        </div>
        
    </main>
    
    <script>
        // Language switcher
        const languageButtons = document.querySelectorAll('.language-button');
        let currentLanguage = 'fr'; // Default language is French
        
        // Function to update audio sources based on language
        function updateAudioSources(lang) {
            document.querySelectorAll('.audio-player').forEach(audio => {
                if (audio.id !== 'bgMusic') { // Skip background music
                    const storyId = audio.dataset.storyId;
                    const source = audio.querySelector('.audio-source');
                    const wasPlaying = !audio.paused;
                    const currentTime = audio.currentTime;
                    
                    // Update source path
                    source.src = `mp3/story${storyId}-${lang.toUpperCase()}.mp3`;
                    
                    // Reload audio (required after changing source)
                    audio.load();
                    
                    // If it was playing, continue playing from the same position
                    if (wasPlaying) {
                        audio.addEventListener('loadedmetadata', function onceLoaded() {
                            audio.currentTime = currentTime;
                            audio.play();
                            audio.removeEventListener('loadedmetadata', onceLoaded);
                        });
                    }
                }
            });
        }
        
        // Function to update story links based on language
        function updateStoryLinks(lang) {
            // Update all read-story links
            document.querySelectorAll('.read-story-link').forEach(link => {
                const storyId = link.closest('.card').dataset.storyId;
                link.href = `story.html?id=${storyId}&lang=${lang}`;
            });
        }
        
        // Function to change language
        function changeLanguage(lang) {
            // Update active button
            languageButtons.forEach(button => {
                if (button.dataset.lang === lang) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            
            // Update card titles
            document.querySelectorAll('.card-title, .read-text').forEach(element => {
                if (element.dataset[lang]) {
                    element.textContent = element.dataset[lang];
                }
            });
            
            // Update audio sources
            updateAudioSources(lang);
            
            // Update story links
            updateStoryLinks(lang);
            
            // Store language preference
            localStorage.setItem('preferredLanguage', lang);
            currentLanguage = lang;
            
            // Update html lang attribute
            document.documentElement.lang = lang;
        }
        
        // Add click event to language buttons
        languageButtons.forEach(button => {
            button.addEventListener('click', function() {
                const lang = this.dataset.lang;
                changeLanguage(lang);
            });
        });
        
        // Check for stored language preference
        const storedLanguage = localStorage.getItem('preferredLanguage');
        if (storedLanguage) {
            changeLanguage(storedLanguage);
        } else {
            // Initialize story links with default language
            updateStoryLinks(currentLanguage);
        }
        
        // Background music functionality
        const bgMusicButton = document.getElementById('bgMusicButton');
        const bgMusic = document.getElementById('bgMusic');
        let isBgMusicPlaying = false;
        
        // Background music button click handler
        bgMusicButton.addEventListener('click', function() {
            const icon = this.querySelector('i');
            
            // If any story audio is playing, pause it
            if (currentlyPlayingAudio) {
                currentlyPlayingAudio.pause();
                const otherCard = currentlyPlayingCard;
                if (otherCard) {
                    const otherIcon = otherCard.querySelector('.play-button i');
                    otherIcon.classList.remove('fa-pause');
                    otherIcon.classList.add('fa-play');
                    otherCard.classList.remove('playing');
                }
                currentlyPlayingCard = null;
                currentlyPlayingAudio = null;
            }
            
            if (bgMusic.paused) {
                // Start playing background music
                bgMusic.play().then(() => {
                    icon.classList.remove('fa-play');
                    icon.classList.add('fa-pause');
                    isBgMusicPlaying = true;
                    bgMusicButton.classList.add('playing');
                }).catch(error => {
                    console.error('Error playing background music:', error);
                });
            } else {
                // Pause background music
                bgMusic.pause();
                icon.classList.remove('fa-pause');
                icon.classList.add('fa-play');
                isBgMusicPlaying = false;
                bgMusicButton.classList.remove('playing');
            }
        });
        
        // Handle background music ending
        bgMusic.addEventListener('ended', function() {
            bgMusicButton.querySelector('i').classList.remove('fa-pause');
            bgMusicButton.querySelector('i').classList.add('fa-play');
            isBgMusicPlaying = false;
            bgMusicButton.classList.remove('playing');
        });
        
        // Audio player functionality
        let currentlyPlayingCard = null;
        let currentlyPlayingAudio = null;
        
        // Format time function (converts seconds to MM:SS format)
        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        document.querySelectorAll('.card').forEach(card => {
            const playButton = card.querySelector('.play-button');
            const progressSlider = card.querySelector('.progress-slider');
            const currentTimeDisplay = card.querySelector('.current-time');
            const durationDisplay = card.querySelector('.duration');
            const audio = card.querySelector('.audio-player');
            const cardImage = card.querySelector('.card-image');
            const storyId = card.dataset.storyId;
            
            // Make card image clickable to navigate to story page
            cardImage.addEventListener('click', function() {
                window.location.href = `story.html?id=${storyId}&lang=${currentLanguage}`;
            });
            
            // Update duration display when metadata is loaded
            audio.addEventListener('loadedmetadata', function() {
                durationDisplay.textContent = formatTime(audio.duration);
                progressSlider.max = Math.floor(audio.duration);
                progressSlider.value = 0;
            });
            
            // Update current time and slider during playback
            audio.addEventListener('timeupdate', function() {
                currentTimeDisplay.textContent = formatTime(audio.currentTime);
                progressSlider.value = Math.floor(audio.currentTime);
            });
            
            // Handle audio ending
            audio.addEventListener('ended', function() {
                playButton.querySelector('i').classList.remove('fa-pause');
                playButton.querySelector('i').classList.add('fa-play');
                card.classList.remove('playing');
                progressSlider.value = 0;   
                currentTimeDisplay.textContent = "0:00";            
                currentlyPlayingCard = null;
                currentlyPlayingAudio = null;
            });
            
            // Play button click handler
            playButton.addEventListener('click', function() {
                const icon = this.querySelector('i');
                
                // If background music is playing, pause it
                if (isBgMusicPlaying) {
                    bgMusic.pause();
                    bgMusicButton.querySelector('i').classList.remove('fa-pause');
                    bgMusicButton.querySelector('i').classList.add('fa-play');
                    isBgMusicPlaying = false;
                    bgMusicButton.classList.remove('playing');
                }
                
                // If another card is playing, pause it first
                if (currentlyPlayingAudio && currentlyPlayingAudio !== audio) {
                    currentlyPlayingAudio.pause();
                    const otherCard = currentlyPlayingCard;
                    if (otherCard) {
                        const otherIcon = otherCard.querySelector('.play-button i');
                        otherIcon.classList.remove('fa-pause');
                        otherIcon.classList.add('fa-play');
                        otherCard.classList.remove('playing');
                    }
                }
                
                if (audio.paused) {
                    // Start playing
                    audio.play().then(() => {
                        icon.classList.remove('fa-play');
                        icon.classList.add('fa-pause');
                        card.classList.add('playing');
                        currentlyPlayingCard = card;
                        currentlyPlayingAudio = audio;
                    }).catch(error => {
                        console.error('Error playing audio:', error);
                    });
                } else {
                    // Pause
                    audio.pause();
                    icon.classList.remove('fa-pause');
                    icon.classList.add('fa-play');
                    card.classList.remove('playing');
                    currentlyPlayingCard = null;
                    currentlyPlayingAudio = null;
                }
            });
            
            // Slider change handler
            progressSlider.addEventListener('input', function() {
                // Just update the time display while dragging
                currentTimeDisplay.textContent = formatTime(this.value);
            });
            
            // When user releases the slider after dragging
            progressSlider.addEventListener('change', function() {
                // Set the audio to the selected position
                audio.currentTime = this.value;
                currentTimeDisplay.textContent = formatTime(audio.currentTime);
            });
        });
        
        // Update "Now Playing" text based on language
        function updateNowPlayingText() {
            document.documentElement.style.setProperty(
                '--now-playing-text', 
                currentLanguage === 'fr' ? '"En cours"' : '"Spielt"'
            );
        }
        
        // Call initially and when language changes
        updateNowPlayingText();
        languageButtons.forEach(button => {
            button.addEventListener('click', updateNowPlayingText);
        });
    </script>
</body>
</html>